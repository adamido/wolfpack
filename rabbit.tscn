[gd_scene load_steps=20 format=3 uid="uid://xsju2ef6c1ci"]

[ext_resource type="Script" uid="uid://cad07t2kf0g7p" path="res://rabbit.gd" id="1_eqa7p"]
[ext_resource type="Texture2D" uid="uid://uo4c41sirml6" path="res://rabbit.svg" id="2_bsnlv"]
[ext_resource type="Resource" uid="uid://q4mkgiqgpmr1" path="res://rabbit_stats.tres" id="2_v8u83"]
[ext_resource type="Script" uid="uid://c173po8aoqij5" path="res://behavior_tree.gd" id="3_bsnlv"]
[ext_resource type="Script" uid="uid://civ7bxwr6gskx" path="res://hop_node.gd" id="4_bsnlv"]
[ext_resource type="Script" uid="uid://bh3jbjirc3qge" path="res://sense_berries.gd" id="5_kdut2"]
[ext_resource type="Script" uid="uid://dweghplx86e3o" path="res://death_node.gd" id="6_0vnsh"]
[ext_resource type="Script" uid="uid://ds1g2cvab2675" path="res://desire_selector.gd" id="7_g7sjl"]
[ext_resource type="Script" uid="uid://c4tw7q4kyx0yc" path="res://eat_berries_node.gd" id="8_2vme1"]
[ext_resource type="Texture2D" uid="uid://cf2dpufw6nw54" path="res://rabbit_dead.png" id="8_75e0b"]
[ext_resource type="Texture2D" uid="uid://n2xrasflpwmd" path="res://rabbit.png" id="9_6f2u8"]
[ext_resource type="Script" uid="uid://bfyf1lagu6twg" path="res://mood_manager.gd" id="10_6f2u8"]
[ext_resource type="Script" uid="uid://nidrq5oy5vf2" path="res://eat_area.gd" id="13_oj77g"]

[sub_resource type="CircleShape2D" id="CircleShape2D_msxim"]
radius = 16.0

[sub_resource type="CircleShape2D" id="CircleShape2D_v8u83"]

[sub_resource type="AtlasTexture" id="AtlasTexture_g7sjl"]
atlas = ExtResource("8_75e0b")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_2vme1"]
atlas = ExtResource("9_6f2u8")
region = Rect2(0, 0, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_oj77g"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_g7sjl")
}],
"loop": true,
"name": &"dead",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_2vme1")
}],
"loop": true,
"name": &"hop",
"speed": 5.0
}]

[sub_resource type="CircleShape2D" id="CircleShape2D_4s0dg"]

[node name="Rabbit" type="CharacterBody2D" node_paths=PackedStringArray("b_tree", "anim", "mood_manager", "nav_agent")]
script = ExtResource("1_eqa7p")
b_tree = NodePath("BehaviorTree")
anim = NodePath("AnimatedSprite2D")
stats_template = ExtResource("2_v8u83")
mood_manager = NodePath("MoodManager")
nav_agent = NodePath("NavigationAgent2D")

[node name="Collision" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_msxim")

[node name="Sprite" type="Sprite2D" parent="."]
texture_filter = 1
texture = ExtResource("2_bsnlv")

[node name="BehaviorTree" type="Node" parent="." node_paths=PackedStringArray("starting_tree_node", "death_node")]
script = ExtResource("3_bsnlv")
starting_tree_node = NodePath("HopNode")
death_node = NodePath("DeathNode")
metadata/_custom_type_script = "uid://c173po8aoqij5"

[node name="HopNode" type="Node" parent="BehaviorTree" node_paths=PackedStringArray("hop_node", "desire_selector_node", "parentTreeNode")]
script = ExtResource("4_bsnlv")
hop_node = NodePath(".")
desire_selector_node = NodePath("../DesireSelector")
parentTreeNode = NodePath(".")
metadata/_custom_type_script = "uid://bovqwy2ievjux"

[node name="DeathNode" type="Node" parent="BehaviorTree" node_paths=PackedStringArray("parentTreeNode")]
script = ExtResource("6_0vnsh")
parentTreeNode = NodePath("../HopNode")
metadata/_custom_type_script = "uid://dweghplx86e3o"

[node name="DesireSelector" type="Node" parent="BehaviorTree" node_paths=PackedStringArray("eat_node", "wander_node", "parentTreeNode")]
script = ExtResource("7_g7sjl")
eat_node = NodePath("EatBerriesNode")
wander_node = NodePath("../HopNode")
parentTreeNode = NodePath("../HopNode")
metadata/_custom_type_script = "uid://ds1g2cvab2675"

[node name="EatBerriesNode" type="Node" parent="BehaviorTree/DesireSelector" node_paths=PackedStringArray("hop_node", "parentTreeNode")]
script = ExtResource("8_2vme1")
hop_node = NodePath("../../HopNode")
parentTreeNode = NodePath("..")
metadata/_custom_type_script = "uid://c4tw7q4kyx0yc"

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
avoidance_enabled = true
radius = 32.0

[node name="HopTimer" type="Timer" parent="."]

[node name="SenseBerries" type="Area2D" parent="."]
collision_mask = 3
script = ExtResource("5_kdut2")

[node name="CollisionShape2D" type="CollisionShape2D" parent="SenseBerries"]
scale = Vector2(20, 20)
shape = SubResource("CircleShape2D_v8u83")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFrames_oj77g")
animation = &"dead"

[node name="MoodManager" type="Node" parent="."]
script = ExtResource("10_6f2u8")
metadata/_custom_type_script = "uid://bfyf1lagu6twg"

[node name="EatArea" type="Area2D" parent="."]
script = ExtResource("13_oj77g")

[node name="CollisionShape2D" type="CollisionShape2D" parent="EatArea"]
scale = Vector2(10, 10)
shape = SubResource("CircleShape2D_4s0dg")

[connection signal="body_entered" from="SenseBerries" to="SenseBerries" method="_on_body_entered"]
[connection signal="body_exited" from="SenseBerries" to="SenseBerries" method="_on_body_exited"]
[connection signal="body_entered" from="EatArea" to="EatArea" method="_on_body_entered"]
[connection signal="body_exited" from="EatArea" to="EatArea" method="_on_body_exited"]
